{{/* docker-compose_base.tmpl */}}
{{ define "docker-compose" }}
version: "3.9"

services:
{{template "execution" .}}
{{if .Mev}}
  mevboost:
    image: {{if .MevImage}}{{.MevImage}}{{else}}flashbots/mev-boost:latest{{end}}
    networks:
      - sedge
    container_name: mev-boost
    restart: on-failure
    entrypoint:
      - /app/mev-boost
      - -addr
      - 0.0.0.0:{{.MevPort}}
      - -{{if .SplittedNetwork}}${EL_NETWORK}{{else}}${NETWORK}{{end}}
      - -relay-check
      - -relays
      - ${RELAY_URL}{{end}}
  {{if or .CcCustomCfg .VlCustomCfg}}config_consensus:
    container_name: config_custom_network
    image: busybox:latest
    volumes:
      - ./:/tmp/app
    command: >
      sh -c "{{if or .CcRemoteCfg .VlRemoteCfg }}wget -O /tmp/app/config.yml ${CONFIG_URL};{{end}}{{if or .CcRemoteGen .VlRemoteGen }}wget -O /tmp/app/genesis.ssz ${GENESIS_URL};{{end}}{{if or .CcRemoteDpl .VlRemoteDpl }}echo -n ${DEPLOY_BLOCK} > /tmp/app/deploy_block.txt;{{end}}"{{end}}{{if .LoggingDriver}}
    logging:
      driver: "{{.LoggingDriver}}"{{if eq .LoggingDriver "json-file"}}
      options:
        max-size: "10m"
        max-file: "10"{{end}}{{end}}
{{template "consensus" .}}
{{template "validator" .}}

  monitor:
    image: posmoni:latest
    networks:
      - sedge
    container_name: monitor
    restart: on-failure
    ports:
      - "12001:12001"
    command: api --port 12001

networks:
  sedge:
    name: sedge_network
{{ end }}